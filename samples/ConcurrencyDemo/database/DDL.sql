
-- Concurrency value 'Key' generated by application (see interceptor in data service)
CREATE TABLE [dbo].[ARecord](
	[Id] [bigint] IDENTITY(1,1) NOT NULL,
	[Value] [varchar](50) NOT NULL,
	[Key] [uniqueidentifier] NOT NULL,
	[ChangedDate] [datetime] NOT NULL,
 CONSTRAINT [PK_ARecord] PRIMARY KEY ([Id])
)
GO

-- Concurrency value 'Key' generated by database (default value on insert, trigger on update)
CREATE TABLE [dbo].[BRecord](
	[Id] [bigint] IDENTITY(1,1) NOT NULL,
	[Value] [varchar](50) NOT NULL,
	[Key] [uniqueidentifier] NOT NULL DEFAULT (NEWID()),
	[ChangedDate] [datetime] NOT NULL,
 CONSTRAINT [PK_BRecord] PRIMARY KEY ([Id])
)
GO
CREATE TRIGGER tr_BRecord_UPDATE ON [dbo].[BRecord]
FOR UPDATE 
AS
  UPDATE r
  SET    r.[Key] = NEWID()
  FROM   [dbo].[BRecord] r INNER JOIN inserted u ON r.[Id] = u.[Id]
GO